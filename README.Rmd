---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# foRgotten

<!-- badges: start -->

<!-- badges: end -->

## Description

The foRgotten library extends the theory of forgotten effects with the aggregation of multiple key informants for complete graphs and chain bipartite graphs. Provides analysis tools for direct effects and forgotten effects.

The package allows for:

-   Calculation of the average incidence by edges for direct effects.
-   Calculation of the average incidence per row and column for direct effects.
-   Calculation of the median betweenness centrality per node for direct effects.
-   Calculation of the forgotten effects.
-   Use of complete graphs and chain bipartite graphs.

## Authors

**Elliott Jamil Mardones Arias** School of Computer Science Universidad Católica de Temuco Rudecindo Ortega 02351 Temuco, Chile [elliott.mardones\@uct.cl](mailto:elliott.mardones@uct.cl)

**Julio Rojas-Mora** Department of Computer Science Universidad Católica de Temuco Rudecindo Ortega 02351 Temuco, Chile and Centro de Políticas Públicas Universidad Católica de Temuco Temuco, Chile [julio.rojas\@uct.cl](mailto:julio.rojas@uct.cl)

## Installation

You can install the stable version of foRgotten from CRAN with:

``` r
# install.packages(“foRgotten”)
```

and the development version from GitHub with:

```{r}
#install.packages(“devtools”)
#devtools::install_github("ElliottMardones/foRgotten")
```

## Usage

```{r example}
library(foRgotten)
```

## 

## Functions

The package provides four functions:

```{r echo=TRUE}
?directEffects
```

Computes the mean incidence, left one-sided confidence interval, and p-value with multiple key informants for complete graphs and chained bipartite graphs. For more details, see help (de.sq).

```{r echo=TRUE}
?bootMargin
```

Computes the mean incidence for each cause and each effect, confidence intervals, and p-value with multiple key informants for complete graphs and chain bipartite graphs. For more details, see help(bootMargin).

```{r echo=TRUE}
?centrality
```

Performs the computation of median betweenness centrality with multiple key informants for complete graphs and chain bipartite graphs. For more details, see help(centrality).

```{r echo=TRUE}
?FE
```

Performs the forgotten effects calculation proposed by Kaufman and Gil-Aluja (1988) with multiple experts. The parameters allow you to specify the significant degree of truth and the order of incidence that is required to be calculated for chained bipartite graphs For more details, see help(FE).

## DataSet

The library provides 3 three-dimensional incidence matrices which are called `CC`, `CE` and `EE`. The data are those used in the study "Application of the Forgotten Effects Theory For Assessing the Public Policy on Air Pollution Of the Commune of Valdivia, Chile" developed by Manna, E. M et al (2018).

The data consists of 16 incentives, 4 behaviors and 10 key informants, where each of the key informants presented the data with a minimum and maximum value for each incident. The description of the data can be seen in Tables 1 and 2 of Manna, E. M et al (2018).

The book store presents the data with the average between the minimum and maximum value for each incidence, A being the equivalent to incentives and B to behaviors. For more details of the data you can consult:

```{r cars}
help(CC)
help(CE)
help(EE)
```

## Examples

### **directEffects()**

The `directEffects()` function calculates the mean incidence, left-sided confidence interval, and p-value for complete graphs and chained bipartite graphs using multiple key informants. This function uses the bootstrap method with adjusted BCa and a left-sided hypothesis test based on the t-test.

The `thr` parameter defines the degree of truth in which the incidence is considered significant within the range [0,1], while `conf.level` defines the confidence level, and `reps` specify the number of bootstrap replicas. By default, `thr = 0.5`, `conf.level = 0.95` and `reps = 10000`.

The `CE` parameter allows you to enter a three-dimensional incidence array, where each submatrix along the z-axis is a square or rectangular incidence matrix. To calculate with complete graphs the matrices must be square. To compute with chained bipartite graphs the matrices must be rectangular, and the parameters `CC` and `EE` must be used, which allows entering three-dimensional incidence arrays where each submatrix along the z-axis is a square and reflective incidence matrix.

Implementation example:

```{r echo=TRUE}
result <- directEffects(CE = CC, thr = 0.5, reps = 1000)
```

The function returns a list object with the subset of data `$DirectEffects` that includes the following information:

-   From: Origin of the incident.
-   To: Destination of the incident.
-   Mean: Average incidence.
-   UCI: Upper Confidence Interval.
-   p.value: The calculated p-value.

In this case, the results correspond to 240 first-order incidences. The first six values are:

```{r}
head(result$DirectEffects)

```

Any result containing a NA value in the UCI and p.value fields indicates that all incidences are the same or that the value is unique. Therefore, bootstrapping is not done.

The `delete` parameter allows you to assign zeros to edges whose incidences are significantly less than `thr` at the p-value set in the `conf.level` parameter. In addition, this allows you to remove non-significant results from the `$DirectEffects` set.

For example, to remove mean incidences less than 0.5 or incidences with a p-value less than 1- `conf.level`:

```{r echo=TRUE, warning=TRUE}
result <- directEffects(CE = CC, thr = 0.5, reps = 1000, delete = TRUE)
```

Significant direct effects decreased from 240 to 205 with `delete = TRUE`.

Note: However, this does not guarantee that a non-significant first-order variable will not generate second-order effects since the data is obtained from its empirical distribution.

For `delete = TRUE`, the function returns `$Data`, the three-dimensional incidence array entered in the `CE` parameter but assigning 0 to non-significant edges.

### bootMargin()

The `bootMargin()` function calculates the mean incidence of each cause and each effect, confidence intervals, and p-values for complete graphs and chained bipartite graphs using multiple key informants. This function uses the bootstrap method with adjusted BCa and a bilateral hypothesis test based on the t-test.

The `thr.cause` and `thr.effect` parameters define the degree of truth in which the incidence is considered significant within the range [0,1], while `conf.level` defines the confidence level, and `reps` specify the number of bootstrap replicates. By default, `thr.cause = 0.5`, `the.effect = 0.5`, `conf.level = 0.95` and `reps = 10000`.

The `CE` parameter allows you to enter a three-dimensional incidence array, where each submatrix along the z-axis is a square or rectangular incidence matrix. To calculate with complete graphs the matrices must be square. To compute with chained bipartite graphs the matrices must be rectangular, and the parameters `CC` and `EE` must be used, which allows entering three-dimensional incidence arrays where each submatrix along the z-axis is a square and reflective incidence matrix.

Implementation example:

```{r}
result <- bootMargin(CE = CC, thr.cause = 0.6,thr.effect =  0.6, reps = 1000)
```

The function returns a list object with the `$byCause` and `$byEffect` subset of data, which includes the following information:

-   Var: Variable name.
-   Mean: Average incidence.
-   LCI: Lower Confidence Interval.
-   ICU: Upper Confidence Interval.
-   p.value: The calculated p-value.

The obtained results are:

For `$byCause`

```{r}
result$byCause

```

For `$byEffect`

```{r}
result$byEffect

```

For `delete = TRUE`, the function allows you to delete causes and effects whose incidences are insignificant at `thr.cause` and `thr.effect` parameters. For example:

```{r}
result <- bootMargin(CE = CC, thr.cause = 0.6,thr.effect =  0.6, reps = 1000, delete = TRUE)
```

For `$byCause`

```{r}
result$byCause
```

For `$byEffect`

```{r}
result$byEffect

```

Additionally, with `delete = TRUE`, the function returns `$Data`, the three-dimensional incidence array entered in the `CE` parameter, but with the rows and columns deleted from each matrix along the z-axis of the three-dimensional array.

For `plot = TRUE`, the function returns `$plot`, which contains a graph generated with the `$byCause` and `$byEffect` subsets. The "Dependence" associated with `$byEffect` is on the x-axis, and the "Influence" associated with `$byCause` is on the y-axis.

```{r}
result <- bootMargin(CE = CC, thr.cause = 0.6,thr.effect =  0.6, reps = 1000, delete = TRUE, plot = TRUE)
result$plot

```

### centralitry()

The `centrality()` function calculates the median betweenness centrality, confidence intervals, and the selected method for calculating the centrality distribution for complete graphs and chain bipartite graphs.

The function contemplates two modalities, the first is focused on complete graphs and the second for chain bipartite graphs.

#### For complete graphs

The `centrality()` function calculates the median betweenness centrality, confidence intervals, and centrality distribution for complete graphs and chained bipartite graphs using multiple key informants. This function uses the bootstrap method with adjusted BCa.

The model parameter allows you to perform bootstrapping with any of the following statistics:

-   `median`.
-   `conpl`: Calculate the median of a power distribution according to Newman M.E (2005).

The goal of the `model` parameter is to determine which heavy-tailed distribution the entered variables or nodes correspond. The parameter `conf.level` defines the confidence level, and `reps` specify the number of bootstrap replicas. By default, `model = median`, `conf.level = 0.95` and `reps = 10000`.

The `CE` parameter allows you to enter a three-dimensional incidence array, where each submatrix along the z-axis is a square or rectangular incidence matrix. To calculate with complete graphs the matrices must be square. To compute with chained bipartite graphs the matrices must be rectangular, and the parameters `CC` and `EE` must be used, which allows entering three-dimensional incidence arrays where each submatrix along the z-axis is a square and reflective incidence matrix.

```{r}
result <- centrality(CE = CC, model = "median", reps = 300)
```

The returned object of type data.frame contains the following components:

-   Var: Name of the variable.
-   Median: Median calculated.
-   LCI: Lower Confidence Interval.
-   ICU: Upper Confidence Interval.
-   Method: Statistical method used associated with the model parameter.

If the median for betweenness centralities is 0, the function will set the LCI and UCI fields to 0 and display a warning on the console.

The results are:

```{r}
result
```

Now if we use `"conpl"` in the model parameter and 300 bootstrap replicas, we get:

```{r}
result <- centrality(CE = CC, model = "conpl", reps = 300)
result
```

**Note:** If `model="conpl"` cannot be used to calculate on any node, the function will perform the calculation with the `model="median"`.

The `centrality()` function implements the parallel function from the boot package. The `parallel` parameter allows you to set the type of parallel operation required. The options are `"multicore"`, `"snow"` and `"no"`. By default `parallel = "no"`. The `ncpus` parameter defines the number of cores to be used. By default, `ncpus = 1`.

The `parallel` and `ncpus`options are not available on Windows operating systems.

### FE()

The `FE()` function calculates forgotten effects, the frequency of their occurrence, the average incidence, confidence intervals, and standard error for complete graphs and chained bipartite graphs using multiple key informants. This function uses the bootstrap method with adjusted BCa.

The `thr` parameter defines the degree of truth in which the incidence is considered significant within the range [0,1]. In contrast, `maxOrder` defines the limit of forgotten effects to be calculated (if any), and `reps` specify the number of bootstrap replicates. By default, `thr = 0.5`, `maxOrder = 2` and `reps = 10000`.

The `CE` parameter allows you to enter a three-dimensional incidence array, where each submatrix along the z-axis is a square or rectangular incidence matrix. To calculate with complete graphs the matrices must be square. To compute with chained bipartite graphs the matrices must be rectangular, and the parameters `CC` and `EE` must be used, which allows entering three-dimensional incidence arrays where each submatrix along the z-axis is a square and reflective incidence matrix.

Implementation example:

```{r}
result <- FE(CE = CE, thr = 0.5, maxOrder = 2, reps = 1000)

```

The function returns a list object with the `$boot` subset of data, which includes the following information:

-   From: Indicates the origin of the forgotten effects relationships.
-   Through_x: Dynamic field that represents the intermediate relationships of the forgotten effects. For example, for order n there will be "though_1" up to "though\_ \<n-1\>".
-   To: Indicates the end of the forgotten effects relationships.
-   Count: Frequency of forgotten effect.
-   Mean: Mean effect of the forgotten effect
-   LCI: Lower Confidence Intervals.
-   UCI: Upper Confidence Intervals.
-   SE: Standard error.

The second list object that the function returns is `$byExpert`, which includes the following information:

-   From: Indicates the origin of the forgotten effects relationships.
-   Through_x: Dynamic field that represents the intermediate relationships of the forgotten effects. For example, for order n there will be "though_1" up to "though\_ \<n-1\>".
-   To: Indicates the end of the forgotten effects of relationships.
-   Count: Number of times the forgotten effect was repeated.
-   Expert_x: Dynamic field that represents each of the entered experts.

If we look at the data in the `$boot$Order_2` data subset, we find 706 2nd order effects and 611 of these effects are unique. The first 6 are:

```{r}
head(result$boot$Order_2)
```

Any result containing a NA value in the UCI and p.value fields indicates that all incidences are the same or that the value is unique. Therefore bootstrapping is not done.

The `FE()` function implements the parallel function from the boot package. The `parallel` parameter allows you to set the type of parallel operation required. The options are `"multicore"`, `"snow"` and `"no"`. By default `parallel = "no"`. The `ncpus` parameter defines the number of cores to be used. By default, `ncpus = 1`.

The `parallel` and `ncpus`options are not available on Windows operating systems.

## References

1.  Kaufmann, A., & Gil Aluja, J. (1988). Modelos para la Investigación de efectos olvidados, Milladoiro. Santiago de Compostela, España.

2.  Manna, E. M., Rojas-Mora, J., & Mondaca-Marino, C. (2018). Application of the Forgotten Effects Theory for Assessing the Public Policy on Air Pollution of the Commune of Valdivia, Chile. In From Science to Society (pp. 61-72). Springer, Cham.

3.  Freeman, L.C. (1979). Centrality in Social Networks I: Conceptual Clarification. Social Networks, 1, 215-239.

4.  Ulrik Brandes, A Faster Algorithm for Betweenness Centrality. Journal of Mathematical Sociology 25(2):163-177, 2001.

5.  Canty A, Ripley BD (2021). boot: Bootstrap R (S-Plus) Functions. R package version 1.3-28.

6.  Davison AC, Hinkley DV (1997). Bootstrap Methods and Their Applications. Cambridge University Press, Cambridge. ISBN 0-521-57391-2, <http://statwww.epfl.ch/davison/BMA/>.

7.  Newman, M. E. (2005). Power laws, Pareto distributions and Zipf's law. Contemporary physics, 46(5), 323-351.

8.  Gillespie, C. S. (2014). Fitting heavy tailed distributions: the poweRlaw package. arXiv preprint arXiv:1407.3492.

9.  Kohl, M., & Kohl, M. M. (2020). Package ‘MKinfer’.
